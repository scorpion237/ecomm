"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[23],{77004:function(e,t,a){a.r(t),a.d(t,{default:function(){return FilterForm}});var r=a(85893),s=a(75077),i=a(67294),n=a(70252),c=a(1816);a(29827);var l=a(40280),o=a(78089);let d=(0,c.u7)(c.e6);function PriceRangeField(e){var t,a,s;let{field:i,onChange:n,values:c,idsPrefix:u}=e,p=(0,o.C)(e=>{var t;return null===(t=e.app.localeSettings)||void 0===t?void 0:t.money.symbol}),{formatCurrency:m}=(0,l.Z)(),onInput=e=>n({[e.target.name]:e.target.value}),h=(null===(t=i.range)||void 0===t?void 0:t.min)?parseFloat(i.range.min):0,f=(null===(a=i.range)||void 0===a?void 0:a.max)?parseFloat(null===(s=i.range)||void 0===s?void 0:s.max):0;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("label",{className:"form-label",children:["Price (",p||"",")"]}),(0,r.jsx)(d,{allowCross:!1,className:"range-slider mb-2",max:f,min:h,onChange:e=>{let[t,a]=e;n({price_min:t!==h?t:"",price_max:a!==f?a:""})},step:.01,tipFormatter:m,value:[c.price_min||h,c.price_max||f]}),(0,r.jsxs)("div",{className:"row",children:[(0,r.jsxs)("div",{className:"col mb-3 d-flex gap-2 justify-content-center",children:[(0,r.jsx)("label",{htmlFor:"".concat(u,"filter_price_min"),className:"text-muted",children:(0,r.jsx)("small",{children:"From"})}),(0,r.jsx)("input",{type:"number",className:"form-control form-control-sm",id:"".concat(u,"filter_price_min"),min:h,placeholder:String(h||""),name:"price_min",step:.01,onChange:onInput,value:c.price_min})]}),(0,r.jsxs)("div",{className:"col mb-3 d-flex gap-2 justify-content-center",children:[(0,r.jsx)("label",{htmlFor:"".concat(u,"filter_price_max"),className:"text-muted",children:(0,r.jsx)("small",{children:"To"})}),(0,r.jsx)("input",{type:"number",className:"form-control form-control-sm",id:"".concat(u,"filter_price_max"),max:f,placeholder:String(f||""),name:"price_max",step:.01,onChange:onInput,value:c.price_max})]})]})]})}var u=a(23279),p=a.n(u),m=a(57557),h=a.n(m),f=a(37005),x=a.n(f),g=a(78718),b=a.n(g),j=a(16518);function MultipleSelectCharacteristic(e){let{field:t,onChange:a,values:s,displayLimit:n,idsPrefix:c}=e,l=t.characteristic,[o,d]=(0,i.useState)([]),[u,p]=(0,i.useState)([]),[m,h]=(0,i.useState)(!1);(0,i.useEffect)(()=>{let{cases:e}=t.characteristic;if(!e)return;let a=e.filter(e=>e.products_qty>0),r=e.filter(e=>!e.products_qty),s=[...a,...r];d(s.slice(0,n)),p(s.slice(n))},[t.characteristic,n]);let onInput=(e,t)=>{let r=l.id in s.props&&Array.isArray(s.props[l.id])?[...s.props[l.id]]:[],i=r.findIndex(t=>String(t)==String(e));t.target.checked?-1===i&&r.push(e):-1!==i&&r.splice(i,1),a({props:{[l.id]:r}})},isChecked=e=>{let t=l.id;return!!(t in s.props&&Array.isArray(s.props[t]))&&s.props[t].some(t=>String(t)==String(e))};return(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{className:"form-label",children:l.title}),(0,r.jsx)(CharacteristicCases,{caseItems:o,characteristicId:l.id,onInput:onInput,isChecked:isChecked,idsPrefix:"".concat(c,"filter_props_").concat(l.id)}),u.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j.Z,{in:m,children:(0,r.jsxs)("div",{children:[" ",(0,r.jsx)("div",{className:"mt-1",children:(0,r.jsx)(CharacteristicCases,{caseItems:u,characteristicId:l.id,onInput:onInput,isChecked:isChecked,idsPrefix:"".concat(c,"filter_props_").concat(l.id)})})]})},l.id),(0,r.jsx)("div",{className:"mt-1",children:(0,r.jsx)("a",{className:"small",href:"#",onClick:e=>{e.preventDefault(),h(e=>!e)},children:(0,r.jsx)(r.Fragment,{children:m?"Show less":"Show all"})})})]})]})}let CharacteristicCases=e=>{let{caseItems:t,characteristicId:a,onInput:s,isChecked:i,idsPrefix:n}=e;return(0,r.jsx)("div",{className:"d-flex gap-1 flex-wrap",children:t.map(e=>{let{case_id:t,title:c,products_qty:l}=e;return(0,r.jsxs)("div",{children:[(0,r.jsx)("input",{className:"btn-check",type:"checkbox",value:t,name:"props[".concat(a,"][]"),id:"".concat(n,"_").concat(t),onChange:s.bind(null,t),checked:i(t),disabled:0===l}),(0,r.jsxs)("label",{className:"btn btn-outline-secondary btn-sm",htmlFor:"".concat(n,"_").concat(t),children:[c," (",l,")"]})]},t)})})};function TextCharacteristic(e){let{field:t,onChange:a,values:s,idsPrefix:i}=e,n=t.characteristic,c="".concat(i,"filter_prop_").concat(n.id);return(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{htmlFor:c,className:"form-label",children:n.title}),(0,r.jsx)("input",{type:"text",className:"form-control",id:c,value:s.props[n.id],onChange:e=>{a({props:{[n.id]:e.target.value}})}})]})}function BrandSelect(e){let{field:t,onChange:a,values:s,displayLimit:n,idsPrefix:c}=e,{brand:l}=s,[o,d]=(0,i.useState)(!1),[u,p]=(0,i.useState)([]),[m,h]=(0,i.useState)([]);(0,i.useEffect)(()=>{let e=t.manufacturers;if(!e)return;let a=e.filter(e=>e.products_qty>0),r=e.filter(e=>!e.products_qty),s=[...a,...r];p(s.slice(0,n)),h(s.slice(n))},[t.manufacturers,n]);let onInput=(e,t)=>{let r=l.filter(t=>t!==e);t.target.checked&&r.push(e),a({brand:r})};return(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{className:"form-label",children:"Brand"}),(0,r.jsx)(BrandCases,{manufacturers:u,onInput:onInput,values:s,idsPrefix:c}),m.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j.Z,{in:o,children:(0,r.jsxs)("div",{children:[" ",(0,r.jsx)("div",{className:"mt-1",children:(0,r.jsx)(BrandCases,{manufacturers:m,onInput:onInput,values:s,idsPrefix:c})})]})}),(0,r.jsx)("div",{className:"mt-1",children:(0,r.jsx)("a",{className:"small",href:"#",onClick:e=>{e.preventDefault(),d(e=>!e)},children:(0,r.jsx)(r.Fragment,{children:o?"Show less":"Show all"})})})]})]})}let BrandCases=e=>{let{manufacturers:t,onInput:a,values:s,idsPrefix:i}=e;return(0,r.jsx)("div",{className:"d-flex gap-1 flex-wrap",children:t.map(e=>{let{manufacturer_id:t,title:n,products_qty:c}=e;return(0,r.jsxs)("div",{children:[(0,r.jsx)("input",{className:"btn-check",id:"".concat(i,"brand_").concat(t),type:"checkbox",value:t,name:"brand[]",onChange:a.bind(null,t),checked:s.brand.includes(t),disabled:0===c}),(0,r.jsxs)("label",{className:"btn btn-outline-secondary btn-sm",htmlFor:"".concat(i,"brand_").concat(t),children:[n," (",c,")"]})]},t)})})};function Stock(e){let{onChange:t,values:a}=e;return(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{className:"form-label",children:"Stock"}),(0,r.jsx)("div",{className:"form-check",children:(0,r.jsxs)("label",{className:"form-check-label",children:[(0,r.jsx)("input",{className:"form-check-input",type:"checkbox",value:"1",name:"in_stock",onChange:e=>t({in_stock:e.target.checked?"1":""}),checked:"1"==a.in_stock}),"In stock"]})})]})}var C=a(28368),v=a.n(C),y=a(7730);function FilterForm(e){let{filterFields:t,queryParams:a,categoryId:n,onSearch:c,idsPrefix:l}=e,[o,d]=(0,i.useState)(!1),[u,m]=(0,i.useState)({}),[f,x]=(0,i.useState)([]),[g,b]=(0,i.useState)(!1),[j,C]=(0,i.useState)(null),[v,_]=(0,i.useState)(null),getData=()=>{let e=sanitizeIncomingQuery(a);b(!0),_(n),fetchRanges(t,{category:[n],...e}).then(t=>{let{ranges:a}=t;m({...e,...makeInitialValues(a,e)}),x(a),b(!1)}).catch(console.error)};(0,i.useEffect)(()=>{let e=filterEmptyValues((0,y.B)(a,y.Y)),t=filterEmptyValues(u);(isFilterQueryChanged(e,t)||v!==n)&&getData()},[a,n]);let k=(0,i.useCallback)(p()(e=>{b(!0),fetchRanges(t,{category:[n],...e}).then(e=>{let{ranges:t,totalProducts:a}=e;x(t),C(a),b(!1)}).catch(console.error)},600),[n]),onChange=e=>{let t="props"in e?{...u,props:Object.assign({},u.props,e.props)}:{...u,...e};m(t),k(t),d(!0)};return f.length?(0,r.jsxs)("form",{className:"category-filters px-1",onSubmit:e=>{e.preventDefault();let t=filterEmptyValues(u);c(h()(t,["page"])),d(!1)},children:[f.map((e,t)=>{switch(e.type){case s.wC.price:return(0,r.jsx)(PriceRangeField,{field:e,onChange:onChange,values:u,idsPrefix:l},t);case s.wC.brand:return(0,r.jsx)(BrandSelect,{field:e,onChange:onChange,values:u,displayLimit:3,idsPrefix:l},t);case s.wC.availability:return(0,r.jsx)(Stock,{field:e,onChange:onChange,values:u,idsPrefix:l},t);case s.wC.characteristic:if(isMultiCaseType(e.characteristic.type))return(0,r.jsx)(MultipleSelectCharacteristic,{field:e,onChange:onChange,values:u,displayLimit:3,idsPrefix:l},t);return(0,r.jsx)(TextCharacteristic,{field:e,onChange:onChange,values:u,idsPrefix:l},t)}}),(0,r.jsx)("div",{className:"category-filters__actions",children:(0,r.jsxs)("div",{className:"btn-group",role:"group",children:[(0,r.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:e=>{e.preventDefault();let a=h()(u,["page",...y.Y]);c(a),m({...a,...makeInitialValues(f,a)}),b(!0),fetchRanges(t,a).then(e=>{let{ranges:t}=e;x(t),d(!1),b(!1)}).catch(console.error)},disabled:g,children:"Clear"}),(0,r.jsx)("button",{type:"submit",className:"btn btn-action",disabled:!o||g,children:getSubmitLabel(o,g,j)})]})})]}):g?(0,r.jsx)("div",{children:"Cargement..."}):null}let fetchRanges=async(e,t)=>{let a=e.map(e=>{let{type:t,characteristic_id:a}=e;return{type:t,characteristic_id:a}}),r=await n.x.catalog.getFilterFieldsRanges({filter_fields:a,values:t});return r},getSubmitLabel=(e,t,a)=>{if(e){if(t)return"Calculating...";if(null!==a)return"Show (".concat(a,")")}return"Search"},makeInitialValues=(e,t)=>{let a={};for(let r of e)switch(r.type){case s.wC.price:Object.assign(a,{price_min:"",price_max:""},b()(t,["price_min","price_max"]));break;case s.wC.brand:Object.assign(a,{brand:(t.brand||[]).map(e=>Number(e))});break;case s.wC.availability:Object.assign(a,{in_stock:t.in_stock||""});break;case s.wC.characteristic:{let e=x()(t.props)&&!Array.isArray(t.props)?t.props:{};"props"in a||(a.props={}),isMultiCaseType(r.characteristic.type)?a.props[r.characteristic_id]=r.characteristic_id in e&&Array.isArray(e[r.characteristic_id])?e[r.characteristic_id]:[]:a.props[r.characteristic_id]=r.characteristic_id in e?String(e[r.characteristic_id]):""}}return a},filterEmptyValues=e=>{let t={};for(let[a,r]of Object.entries(e))if("props"==a){let e=filterEmptyValues(r);Object.keys(e).length&&(t[a]=e)}else Array.isArray(r)?r.length&&(t[a]=r):""!==r&&(t[a]=r);return t},sanitizeIncomingQuery=e=>{let t={};for(let[a,r]of Object.entries(e))"props"===a?x()(r)&&!Array.isArray(r)&&(t[a]=r):t[a]=r;return t},isFilterQueryChanged=(e,t)=>{let compare=(e,t)=>String(e)===String(t);for(let a of y.Y)if(a in e||a in t){if(["props","brand"].includes(a)){if(!v()(e[a],t[a],compare))return!0}else if(String(e[a])!==String(t[a]))return!0}return!1},isMultiCaseType=e=>[s.PL.radio,s.PL.select,s.PL.checkbox].includes(e)}}]);